<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>One-time links</title>
</head>
<body>

<form method="post" action="/create">
  <input name="target_url" placeholder="Вставьте ссылку" required>
  <button type="submit">Сгенерировать</button>
</form>

<br>

<input type="text" value="{{ link }}" readonly style="width:100%;">

<h3>История ссылок</h3>

<div id="history">
{% for code, item in links.items() %}
  <div style="display:flex;align-items:center;margin-bottom:6px;">
    <span style="
      width:10px;height:10px;border-radius:50%;
      display:inline-block;margin-right:8px;
      background:
        {% if item.state == 'NEW' %}#facc15
        {% elif item.state == 'OPENED' %}#22c55e
        {% else %}#ef4444{% endif %};
    "></span>
    <span>{{ item.url }}</span>
  </div>
{% endfor %}
</div>

<script>
setInterval(() => {
  fetch('/status')
    .then(r => r.json())
    .then(data => {
      const h = document.getElementById('history');
      h.innerHTML = '';
      for (const k in data) {
        let c = '#facc15';
        if (data[k].state === 'OPENED') c = '#22c55e';
        if (data[k].state === 'USED') c = '#ef4444';

        h.innerHTML += `
          <div style="display:flex;align-items:center;margin-bottom:6px;">
            <span style="width:10px;height:10px;border-radius:50%;
            display:inline-block;margin-right:8px;background:${c};"></span>
            <span>${data[k].url}</span>
          </div>`;
      }
    });
}, 4000);
</script>

</body>
</html>





