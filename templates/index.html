<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ê–¥–º–∏–Ω–∫–∞</title>

    <!-- –¢–≤–æ–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è -->
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

    <h1>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h1>

    <!-- === –¢–í–û–ô –°–£–©–ï–°–¢–í–£–Æ–©–ò–ô –ö–û–ù–¢–ï–ù–¢ === -->
    <!-- —Ç–∞–±–ª–∏—Ü–∞ —Å—Å—ã–ª–æ–∫, —Ñ–æ—Ä–º—ã, –∫–Ω–æ–ø–∫–∏ –∏ —Ç.–¥. -->
    <!-- –Ø –≠–¢–û –ù–ï –ú–ï–ù–Ø–Æ -->

    <!-- ================================================= -->
    <!-- üîî –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø (–î–û–ë–ê–í–õ–ï–ù–û, –ù–ò–ß–ï–ì–û –ù–ï –õ–û–ú–ê–ï–¢) -->
    <!-- ================================================= -->

    <script>
    // –•—Ä–∞–Ω–∏–º –∏–∑–≤–µ—Å—Ç–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã —Å—Å—ã–ª–æ–∫
    let knownStates = {};
    const POLL_INTERVAL = 3000; // 3 —Å–µ–∫—É–Ω–¥—ã

    async function pollStatus() {
        try {
            const res = await fetch("/status");
            if (!res.ok) return;

            const data = await res.json();

            for (const code in data) {
                const state = data[code].state;

                // –ø–µ—Ä–≤–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ —Å—Å—ã–ª–∫–∏ ‚Äî –ø—Ä–æ—Å—Ç–æ –∑–∞–ø–æ–º–∏–Ω–∞–µ–º
                if (!(code in knownStates)) {
                    knownStates[code] = state;
                    continue;
                }

                // —Ä–µ–∞–≥–∏—Ä—É–µ–º –¢–û–õ–¨–ö–û –Ω–∞ NEW ‚Üí OPENED
                if (knownStates[code] === "NEW" && state === "OPENED") {
                    showNotification("–ö–ª–∏–µ–Ω—Ç –æ—Ç–∫—Ä—ã–ª —Å—Å—ã–ª–∫—É");
                    playSound();
                }

                knownStates[code] = state;
            }
        } catch (e) {
            // –º–æ–ª—á–∞ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
        }
    }

    function showNotification(text) {
        const note = document.createElement("div");
        note.textContent = text;

        // –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–ª–∞—Å—Å, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
        note.className = "notification";

        document.body.appendChild(note);

        setTimeout(() => {
            note.remove();
        }, 4000);
    }

    // –∑–≤—É–∫ (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∫–ª–∏–∫–∞ ‚Äî —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –±—Ä–∞—É–∑–µ—Ä–æ–≤)
    let notificationSound = null;
    let soundEnabled = true;

    function playSound() {
        if (!soundEnabled || !notificationSound) return;
        notificationSound.play().catch(() => {});
    }

    document.addEventListener("click", () => {
        if (!notificationSound) {
            notificationSound = new Audio(
                "https://actions.google.com/sounds/v1/alarms/beep_short.ogg"
            );
        }
    }, { once: true });

    // –∑–∞–ø—É—Å–∫ –æ–ø—Ä–æ—Å–∞
    setInterval(pollStatus, POLL_INTERVAL);
    </script>

</body>
</html>










