<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€ ÑÑÑ‹Ğ»Ğ¾Ğº</title>

<audio id="notifySound">
  <source src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg">
</audio>

<script>
let lastOpened = "{{ links[0].opened_at if links else '' }}";

setInterval(async () => {
  const res = await fetch("/");
  const text = await res.text();

  const parser = new DOMParser();
  const doc = parser.parseFromString(text, "text/html");
  const newOpened = doc.querySelector(".opened-at")?.innerText;

  if (newOpened && newOpened !== lastOpened) {
    playSound();
    lastOpened = newOpened;
  }
}, 5000);

function playSound() {
  if (localStorage.getItem("sound") === "off") return;
  const audio = document.getElementById("notifySound");
  audio.currentTime = 0;
  audio.play().catch(()=>{});
}
</script>

</head>
<body>

<label>
  <input type="checkbox" id="soundToggle" checked>
  ğŸ”” Ğ—Ğ²ÑƒĞº ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹
</label>

<script>
const toggle = document.getElementById("soundToggle");
if (localStorage.getItem("sound") === "off") toggle.checked = false;

toggle.onchange = () => {
  localStorage.setItem("sound", toggle.checked ? "on" : "off");
};
</script>

<hr>

<form method="post" action="/create">
  <input name="target_url" placeholder="Ğ¡ÑÑ‹Ğ»ĞºĞ° Ğ´Ğ»Ñ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸" required>
  <input name="label" placeholder="ĞŸĞ¾Ğ»Ğµ">
  <button type="submit">Ğ¡Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ</button>
</form>

<hr>

{% for l in links %}
<div>
  <span>
    {% if l.status == "new" %}ğŸŸ¡{% elif l.status == "opened" %}ğŸŸ¢{% else %}ğŸ”´{% endif %}
  </span>
  {{ l.short }} â€” <b>{{ l.label }}</b><br>
  Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ°: {{ l.created_at }}<br>
  {% if l.opened_at %}
    <span class="opened-at">ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ğ°: {{ l.opened_at }}</span>
  {% endif %}
</div>
<hr>
{% endfor %}

</body>
</html>









