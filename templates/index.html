<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>One-time link</title>
<style>
body { font-family: Arial; background:#f4f6f8; }
.container { max-width:720px; margin:50px auto; background:#fff; padding:30px; border-radius:14px; }
.form-row { display:flex; gap:10px; }
input { padding:12px; border-radius:10px; border:1px solid #ccc; flex:1; }
button { padding:12px 18px; border-radius:10px; background:#4f46e5; color:#fff; border:none; }
.history-item { display:flex; align-items:center; margin-bottom:8px; }
.dot { width:10px; height:10px; border-radius:50%; margin-right:8px; }
.new{background:#facc15;} .opened{background:#22c55e;} .used{background:#ef4444;}
.time{font-size:12px;color:#6b7280;}
</style>
</head>

<body>
<div class="container">
  <form method="post" action="/create">
    <div class="form-row">
      <input id="mainInput" name="target_url" value="{{ link }}" placeholder="Вставьте ссылку" required>
      <button type="submit">Сгенерировать</button>
    </div>
  </form>

  <button onclick="copy()">Скопировать</button>

  <h3>История</h3>
  <div id="history">
    {% for code, item in links.items() %}
      <div class="history-item">
        <span class="dot {% if item.state=='NEW' %}new{% elif item.state=='OPENED' %}opened{% else %}used{% endif %}"></span>
        <div>
          {{ request.base_url }}l/{{ code }}
          <div class="time">{{ item.created_at }}</div>
        </div>
      </div>
    {% endfor %}
  </div>
</div>

<script>
function copy(){
  const i=document.getElementById('mainInput');
  i.select();document.execCommand('copy');
}

setInterval(()=>{
  fetch('/status').then(r=>r.json()).then(d=>{
    const h=document.getElementById('history');
    h.innerHTML='';
    Object.keys(d).reverse().forEach(code=>{
      const s=d[code].state;
      const cls=s==='NEW'?'new':s==='OPENED'?'opened':'used';
      h.innerHTML+=`
        <div class="history-item">
          <span class="dot ${cls}"></span>
          <div>
            ${location.origin}/l/${code}
            <div class="time">${d[code].created_at||''}</div>
          </div>
        </div>`;
    });
  });
},4000);
</script>
</body>
</html>






